<div class="flow-container">
  <!-- Header Section -->
  <mat-card class="flow-header-card">
    <mat-card-content>
      <div class="flow-title">
        <mat-icon class="title-icon">account_tree</mat-icon>
        <span class="title-text">Data Flow: {{ flowData.id }}</span>
        <mat-chip class="severity-chip">{{ flowData.severity }}</mat-chip>
      </div>
      <div class="flow-summary">{{ flowData.summary }}</div>
    </mat-card-content>
  </mat-card>

  <!-- Main Content: Graph + Details -->
  <div class="content-grid" *ngIf="flowData.nodes.length > 0; else noResults">
    <!-- Left: ECharts Graph -->
    <mat-card class="chart-card">
      <mat-card-content class="chart-content">
        <div #chartContainer class="chart-container"></div>
      </mat-card-content>
    </mat-card>

    <!-- Right: Selected Node Details -->
    <mat-card class="details-card" *ngIf="selectedNode">
      <mat-card-content class="details-content">
        <!-- Node Header -->
        <div class="details-header">
          <div class="details-badge-row">
            <mat-chip [class]="'detail-badge ' + selectedNode.type + '-badge'">
              <mat-icon class="badge-icon">{{ getNodeIcon(selectedNode.type) }}</mat-icon>
              <span>{{ selectedNode.badge }}</span>
            </mat-chip>
            <span class="details-node-number">#{{ selectedNode.id }}</span>
          </div>

          <div class="details-title-row">
            <div class="details-icon-wrapper" [class.dangerous]="selectedNode.vulnerable">
              <mat-icon>{{ selectedNode.vulnerable ? 'warning' : 'code' }}</mat-icon>
            </div>
            <div>
              <div class="details-node-name">{{ selectedNode.name }}</div>
              <div class="details-node-location">üìÑ {{ selectedNode.location }}</div>
            </div>
          </div>
        </div>

        <!-- Node Details -->
        <div class="details-body">
          <div class="detail-row">
            <span class="detail-label">Label:</span>
            <span class="detail-value">{{ selectedNode.label }}</span>
          </div>

          <div class="detail-row" *ngIf="selectedNode.method">
            <span class="detail-label">Method:</span>
            <span class="detail-value detail-method">{{ selectedNode.method }}</span>
          </div>

          <div class="detail-row" *ngIf="selectedNode.dataType">
            <span class="detail-label">Type:</span>
            <span class="detail-value">{{ selectedNode.dataType }}</span>
          </div>

          <div class="detail-row" *ngIf="selectedNode.returnType">
            <span class="detail-label">Return Type:</span>
            <span class="detail-value">{{ selectedNode.returnType }}</span>
          </div>

          <div class="detail-row code-row">
            <span class="detail-label">Code:</span>
          </div>
          <pre class="details-code">{{ selectedNode.code }}</pre>

          <div class="details-warning" *ngIf="selectedNode.vulnerable">
            <mat-icon class="warning-icon">error</mat-icon>
            <span class="warning-text">Vulnerable operation: untrusted data reaches dangerous sink!</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- No Results Message -->
  <ng-template #noResults>
    <mat-card class="no-results-card">
      <mat-card-content class="no-results-content">
        <mat-icon class="no-results-icon">search_off</mat-icon>
        <h3 class="no-results-title">–ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤</h3>
        <p class="no-results-text">–°–ø—Ä–æ–±—É–π—Ç–µ –∑–º—ñ–Ω–∏—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –ø–æ—à—É–∫—É</p>
      </mat-card-content>
    </mat-card>
  </ng-template>
</div>
