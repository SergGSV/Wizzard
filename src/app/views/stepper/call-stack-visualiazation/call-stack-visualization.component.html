<!-- call-stack-visualization.component.html -->
<div class="flow-container">
  <mat-card class="flow-header-card">
    <mat-card-header>
      <div class="flow-title">
        <mat-icon>account_tree</mat-icon>
        <span>Data Flow: {{ flowData.id }}</span>
        <mat-chip-set>
          <mat-chip class="severity-chip" highlighted>{{ flowData.severity }}</mat-chip>
        </mat-chip-set>
      </div>
      <div class="flow-summary">{{ flowData.summary }}</div>
    </mat-card-header>
  </mat-card>

  <div class="visualization-wrapper">
    <!-- ECharts Graph Visualization -->
    <div class="chart-section">
      <mat-card>
        <mat-card-content>
          <div #chartContainer class="chart-container"></div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Nodes List with Details -->
    <div class="nodes-section">
      <mat-accordion>
        <mat-expansion-panel
          *ngFor="let node of flowData.nodes; let i = index"
          [expanded]="selectedNodeId === node.id"
          (opened)="selectNode(node.id)"
          [class.source-panel]="node.type === 'source'"
          [class.sink-panel]="node.type === 'sink'"
          [class.path-panel]="node.type === 'path'">

          <mat-expansion-panel-header>
            <mat-panel-title>
              <div class="node-header">
                <mat-chip-set>
                  <mat-chip [class]="node.type + '-badge'">
                    <mat-icon>{{ getNodeIcon(node.type) }}</mat-icon>
                    {{ node.badge }}
                  </mat-chip>
                </mat-chip-set>
                <span class="node-number">#{{ node.id }}</span>
              </div>
            </mat-panel-title>
            <mat-panel-description>
              <div class="node-preview">
                <mat-icon [class.dangerous]="node.vulnerable">
                  {{ node.vulnerable ? 'warning' : 'code' }}
                </mat-icon>
                <div>
                  <div class="node-name">{{ node.name }}</div>
                  <div class="node-location">ðŸ“„ {{ node.location }}</div>
                </div>
              </div>
            </mat-panel-description>
          </mat-expansion-panel-header>

          <!-- Node Details -->
          <div class="node-details">
            <div class="detail-row">
              <span class="detail-label">Label:</span>
              <span class="detail-value">{{ node.label }}</span>
            </div>

            <div class="detail-row" *ngIf="node.method">
              <span class="detail-label">Method:</span>
              <span class="detail-value">{{ node.method }}</span>
            </div>

            <div class="detail-row" *ngIf="node.dataType">
              <span class="detail-label">Type:</span>
              <span class="detail-value">{{ node.dataType }}</span>
            </div>

            <div class="detail-row" *ngIf="node.returnType">
              <span class="detail-label">Return Type:</span>
              <span class="detail-value">{{ node.returnType }}</span>
            </div>

            <div class="detail-row">
              <span class="detail-label">Code:</span>
            </div>
            <code class="code-snippet">{{ node.code }}</code>

            <div class="vulnerability-warning" *ngIf="node.vulnerable">
              <mat-icon>error</mat-icon>
              <span>Vulnerable operation: untrusted data reaches dangerous sink!</span>
            </div>
          </div>
        </mat-expansion-panel>
      </mat-accordion>
    </div>
  </div>
</div><!-- call-stack-visualization.component.html -->
<div class="flow-container">
  <mat-card class="flow-header-card">
    <mat-card-header>
      <div class="flow-title">
        <mat-icon>account_tree</mat-icon>
        <span>Data Flow: {{ flowData.id }}</span>
        <mat-chip-set>
          <mat-chip class="severity-chip" highlighted>{{ flowData.severity }}</mat-chip>
        </mat-chip-set>
      </div>
      <div class="flow-summary">{{ flowData.summary }}</div>
    </mat-card-header>
  </mat-card>

  <div class="visualization-wrapper">
    <!-- ECharts Graph Visualization -->
    <div class="chart-section">
      <mat-card>
        <mat-card-content>
          <div #chartContainer class="chart-container"></div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Nodes List with Details -->
    <div class="nodes-section">
      <mat-accordion>
        <mat-expansion-panel
          *ngFor="let node of flowData.nodes; let i = index"
          [expanded]="selectedNodeId === node.id"
          (opened)="selectNode(node.id)"
          [class.source-panel]="node.type === 'source'"
          [class.sink-panel]="node.type === 'sink'"
          [class.path-panel]="node.type === 'path'">

          <mat-expansion-panel-header>
            <mat-panel-title>
              <div class="node-header">
                <mat-chip-set>
                  <mat-chip [class]="node.type + '-badge'">
                    <mat-icon>{{ getNodeIcon(node.type) }}</mat-icon>
                    {{ node.badge }}
                  </mat-chip>
                </mat-chip-set>
                <span class="node-number">#{{ node.id }}</span>
              </div>
            </mat-panel-title>
            <mat-panel-description>
              <div class="node-preview">
                <mat-icon [class.dangerous]="node.vulnerable">
                  {{ node.vulnerable ? 'warning' : 'code' }}
                </mat-icon>
                <div>
                  <div class="node-name">{{ node.name }}</div>
                  <div class="node-location">ðŸ“„ {{ node.location }}</div>
                </div>
              </div>
            </mat-panel-description>
          </mat-expansion-panel-header>

          <!-- Node Details -->
          <div class="node-details">
            <div class="detail-row">
              <span class="detail-label">Label:</span>
              <span class="detail-value">{{ node.label }}</span>
            </div>

            <div class="detail-row" *ngIf="node.method">
              <span class="detail-label">Method:</span>
              <span class="detail-value">{{ node.method }}</span>
            </div>

            <div class="detail-row" *ngIf="node.dataType">
              <span class="detail-label">Type:</span>
              <span class="detail-value">{{ node.dataType }}</span>
            </div>

            <div class="detail-row" *ngIf="node.returnType">
              <span class="detail-label">Return Type:</span>
              <span class="detail-value">{{ node.returnType }}</span>
            </div>

            <div class="detail-row">
              <span class="detail-label">Code:</span>
            </div>
            <code class="code-snippet">{{ node.code }}</code>

            <div class="vulnerability-warning" *ngIf="node.vulnerable">
              <mat-icon>error</mat-icon>
              <span>Vulnerable operation: untrusted data reaches dangerous sink!</span>
            </div>
          </div>
        </mat-expansion-panel>
      </mat-accordion>
    </div>
  </div>
</div>
