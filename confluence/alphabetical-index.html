{html}
<div id="alphabetical-index"></div>
<script>
  (function() {
    // Затримка для завантаження контенту
    setTimeout(function() {
      // Знаходимо всі h3 на сторінці
      const headers = Array.from(document.querySelectorAll('h3'));

      if (headers.length === 0) {
        document.getElementById('alphabetical-index').innerHTML =
          '<p style="color:#999;">Заголовки h3 не знайдено на сторінці</p>';
        return;
      }

      // Групуємо за першою літерою
      const grouped = {};
      headers.forEach(h3 => {
        const text = h3.textContent.trim();
        if (!text) return;

        const firstLetter = text[0].toUpperCase();
        if (!grouped[firstLetter]) {
          grouped[firstLetter] = [];
        }

        // Додаємо або використовуємо існуючий anchor
        let anchorId = h3.id;
        if (!anchorId) {
          anchorId = 'header-' + text.replace(/[^a-zA-Z0-9]/g, '-').toLowerCase();
          h3.id = anchorId;
        }

        grouped[firstLetter].push({
          text: text,
          anchor: anchorId,
          element: h3
        });
      });

      // Сортуємо літери
      const letters = Object.keys(grouped).sort();

      // Додаємо ID до контейнера змісту
      const indexContainer = document.getElementById('alphabetical-index');
      indexContainer.setAttribute('id', 'toc-index');

      // Будуємо HTML
      let html = '<div class="alpha-index" style="border:1px solid #ddd; padding:15px; background:#f9f9f9; margin:20px 0; border-radius:5px;">';

      // Літерний індекс зверху
      html += '<div style="text-align:center; margin-bottom:20px; padding:10px; background:white; border:1px solid #ddd; border-radius:3px;">';
      html += letters.map(l => `<strong style="padding:0 10px; font-size:18px; color:#0052cc;">${l}</strong>`).join(' | ');
      html += '</div>';

      // Групи по літерах
      letters.forEach(letter => {
        html += `<div style="margin-bottom:15px;">`;
        html += `<h4 style="color:#0052cc; margin-bottom:8px; font-size:16px;">${letter}</h4>`;
        html += '<ul style="margin-left:20px; list-style-type:disc;">';

        // Сортуємо елементи в групі
        grouped[letter].sort((a,b) => a.text.localeCompare(b.text, 'uk')).forEach(item => {
          html += `<li style="margin:5px 0;">
          <a href="#${item.anchor}" class="toc-link" data-anchor="${item.anchor}"
             style="color:#0052cc; text-decoration:none;">${item.text}</a>
        </li>`;
        });

        html += '</ul></div>';
      });

      html += '</div>';

      indexContainer.innerHTML = html;

      // Додаємо кнопки повернення до змісту біля кожного h3
      headers.forEach(h3 => {
        // Перевіряємо, чи вже є кнопка
        if (h3.querySelector('.back-to-toc')) return;

        const backButton = document.createElement('a');
        backButton.href = '#toc-index';
        backButton.className = 'back-to-toc';
        backButton.innerHTML = '↑ До змісту';
        backButton.style.cssText = `
        margin-left: 15px;
        font-size: 12px;
        color: #0052cc;
        text-decoration: none;
        padding: 3px 8px;
        border: 1px solid #0052cc;
        border-radius: 3px;
        display: inline-block;
        vertical-align: middle;
        background: white;
        transition: all 0.2s;
      `;

        // Hover ефект
        backButton.addEventListener('mouseenter', function() {
          this.style.background = '#0052cc';
          this.style.color = 'white';
        });
        backButton.addEventListener('mouseleave', function() {
          this.style.background = 'white';
          this.style.color = '#0052cc';
        });

        h3.appendChild(backButton);
      });

      // Функція плавного скролу
      function smoothScroll(target) {
        const element = document.querySelector(target);
        if (element) {
          const offset = 80; // Відступ зверху
          const elementPosition = element.getBoundingClientRect().top;
          const offsetPosition = elementPosition + window.pageYOffset - offset;

          window.scrollTo({
            top: offsetPosition,
            behavior: 'smooth'
          });
        }
      }

      // Обробники для посилань у змісті
      document.querySelectorAll('.toc-link').forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          const anchor = this.getAttribute('data-anchor');
          smoothScroll('#' + anchor);

          // Оновлюємо URL без перезавантаження
          if (history.pushState) {
            history.pushState(null, null, '#' + anchor);
          }
        });
      });

      // Обробники для кнопок "До змісту"
      document.querySelectorAll('.back-to-toc').forEach(button => {
        button.addEventListener('click', function(e) {
          e.preventDefault();
          smoothScroll('#toc-index');

          // Оновлюємо URL
          if (history.pushState) {
            history.pushState(null, null, '#toc-index');
          }
        });
      });

    }, 500);
  })();
</script>

<style>
  .back-to-toc:hover {
    transform: translateY(-2px);
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }
</style>
{html}
